---
import Layout from "@/layouts/Layout.astro";
import ContentBanner from "@/components/ContentBanner.astro";
import { getTranslation, languages } from "@/i18n/translations";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const allSurveys = await getCollection("participate");

  return languages.map((lang) => {
    const surveys = allSurveys.filter((survey) =>
      survey.id.startsWith(`${lang}/`),
    );

    return {
      params: { lang },
      props: { surveys, lang },
    };
  });
}

const { surveys, lang } = Astro.props;
const t = getTranslation(lang);
---

<Layout
  title={t.participate}
  lang={lang}
  description={t.participateDescription}
>
  <ContentBanner>
    <div class="flex flex-col gap-6">
      {
        surveys.map((survey) => (
          <div class="bg-base-300 shadow-lg p-3 rounded-2xl">
            <div class="flex flex-col text-center">
              <div class="text-4xl font-serif mb-4">{survey.data.title}</div>
              {survey.data.catchphrase && (
                <p class="text-lg mb-4">{survey.data.catchphrase}</p>
              )}
              <p class="text-lg mb-4">{survey.data.description}</p>
              <div class="flex justify-center mb-8">
                <div class="w-48 aspect-square">
                  <Image
                    src={survey.data.coverImage}
                    alt=""
                    width={256}
                    height={256}
                    class="w-full h-full rounded-2xl object-cover"
                  />
                </div>
              </div>
              {survey.data.subtitle && (
                <p class="text-xl font-bold text-primary mb-4">{survey.data.subtitle}</p>
              )}
              <div class="flex flex-wrap gap-2 justify-center mb-4">
                {survey.data.buttons.map((button) => (
                  <a
                    href={button.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="btn btn-soft btn-primary"
                  >
                    {button.text}
                  </a>
                ))}
              </div>
              {survey.data.partnerLogo && (
                <div class="flex justify-center">
                  <Image
                    src={survey.data.partnerLogo}
                    alt=""
                    width={600}
                    quality={100}
                    class="max-w-full h-auto"
                  />
                </div>
              )}
              <p class="italic text-sm mt-4">
                {t.researcherNote}{" "}
                <a href={`/${lang}/contact`} class="link">
                  {t.contactPage}
                </a>
                .
              </p>
            </div>
          </div>
        ))
      }
    </div>
  </ContentBanner>
</Layout>
